---
import Base from "../../layouts/Base.astro";
import NeonCard from "../../components/ui/NeonCard.astro";
import HUDGrid from "../../components/hud/HUDGrid.astro";
import NeonFrame from "../../components/hud/NeonFrame.astro";
import ParticleField from "../../components/hud/ParticleField.astro";

/**
 * Project Page: MLMS (Music Library Management System)
 * Author: Zeshan Basaran
 * Repo: https://github.com/zeshanbasaran/mlms-project
 * Description:
 *   Futuristic/sci‚Äëfi themed project detail page in the same visual style
 *   as the Systematic Backtester page. Uses existing HUD/Neon UI components
 *   and client-side GitHub API fetches for live repo stats and language mix.
 *
 * Notes:
 *   - Assumes you have shared components already created:
 *       ‚Ä¢ Base (site layout wrapper)
 *       ‚Ä¢ NeonCard, HUDGrid, NeonFrame, ParticleField, Tabs
 *   - TailwindCSS classes rely on your global theme tokens.
 *   - Update the preview image paths if you add real screenshots.
 */

const owner = "zeshanbasaran";
const repo  = "mlms-project";
const title = "Music Library Management System (MLMS)";
const tagline = "Admin-first, locally hosted music library with clean Tailwind UI, playlists, and role-based access.";
---

<!-- Page Wrapper -->
<Base title={`${title} ¬∑ Project`} description={tagline}>
  <!-- Decorative Background Layer -->
  <div class="fixed inset-0 -z-10 overflow-hidden">
    <ParticleField class="opacity-30" />
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-cyan-500/5 to-purple-500/5 pointer-events-none"></div>
  </div>

  <!-- Back Link -->
  <section class="relative mx-auto max-w-6xl px-4 pt-10">
    <a href="/projects" class="inline-flex items-center gap-2 text-slate-300 hover:text-white">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M15.5 19a1 1 0 0 1-.7-.29l-6-6a1 1 0 0 1 0-1.42l6-6a1 1 0 1 1 1.4 1.42L10.9 12l5.3 5.29A1 1 0 0 1 15.5 19Z"/></svg>
      Back to Projects
    </a>
  </section>

  <!-- Hero -->
  <section class="relative mx-auto max-w-6xl px-4 py-8 sm:py-10">
    <HUDGrid class="absolute inset-0 -z-10 opacity-20" />

    <div class="flex items-start justify-between gap-6">
      <div>
        <h1 class="font-display text-3xl sm:text-5xl tracking-tight text-white">{title}</h1>
        <p class="mt-3 max-w-3xl text-slate-300/90">{tagline}</p>

        <div class="mt-6 flex flex-wrap gap-3">
          <a href={`https://github.com/${owner}/${repo}`} target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 rounded-2xl border border-cyan-400/30 bg-cyan-400/10 px-4 py-2 text-cyan-200 hover:bg-cyan-400/20">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 .5C5.73.5.99 5.24.99 11.52c0 4.86 3.15 8.98 7.51 10.43.55.1.76-.24.76-.53 0-.26-.01-1.13-.02-2.05-3.05.66-3.7-1.3-3.7-1.3-.5-1.27-1.23-1.61-1.23-1.61-.99-.68.07-.67.07-.67 1.1.08 1.68 1.13 1.68 1.13.98 1.68 2.57 1.2 3.2.91.1-.71.38-1.2.69-1.48-2.43-.28-4.98-1.22-4.98-5.42 0-1.2.43-2.18 1.14-2.95-.12-.28-.5-1.4.11-2.93 0 0 .95-.3 3.12 1.13a10.82 10.82 0 0 1 2.84-.38c.96 0 1.93.13 2.84.38 2.17-1.43 3.12-1.13 3.12-1.13.61 1.53.23 2.65.11 2.93.71.77 1.14 1.75 1.14 2.95 0 4.21-2.56 5.13-5 5.4.39.34.73 1 .73 2.02 0 1.46-.01 2.64-.01 3 0 .29.2.64.77.53A10.53 10.53 0 0 0 23 11.52C23 5.24 18.27.5 12 .5Z"/></svg>
            View on GitHub
          </a>
          <a href={`https://github.com/${owner}/${repo}#quickstart`} target="_blank" rel="noopener"
             class="inline-flex items-center gap-2 rounded-2xl border border-purple-400/30 bg-purple-400/10 px-4 py-2 text-purple-200 hover:bg-purple-400/20">
            Quickstart
          </a>
        </div>
      </div>

      <!-- Small counters (right) -->
      <div class="hidden sm:flex items-center gap-6 text-slate-300">
        <div class="flex items-center gap-2"><span>‚≠ê</span><span id="heroStars">0</span></div>
        <div class="flex items-center gap-2"><span>üç¥</span><span id="heroForks">0</span></div>
        <div class="flex items-center gap-2"><span>ü™≤</span><span id="heroIssues">0</span></div>
      </div>
    </div>
  </section>

  <!-- Three primary cards, matching backtester layout -->
  <section class="mx-auto max-w-6xl px-4 pb-8 sm:pb-12">
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
      <!-- What it is -->
      <NeonCard class="p-6 lg:col-span-1">
        <h2 class="font-display text-2xl text-white">What it is</h2>
        <p class="mt-3 text-slate-300/90">
          Admin-first, locally hosted music library app with a clean Tailwind UI. It supports
          artist ‚Üí album ‚Üí track hierarchy, inline CRUD, bulk actions with confirmations, toast
          notifications, and role-based access (admin vs. user). Playlists can be created and
          previewed, and you can add/remove tracks across the library quickly.
        </p>
      </NeonCard>

      <!-- Stack (with live language list) -->
      <NeonCard class="p-6 lg:col-span-1">
        <h2 class="font-display text-2xl text-white">Stack</h2>
        <p class="mt-3 text-slate-300/90">Astro ‚Ä¢ TypeScript ‚Ä¢ Tailwind ‚Ä¢ MySQL ‚Ä¢ Node</p>
        <ul id="langListStack" class="mt-4 space-y-1 text-slate-300/90 text-sm">
          <!-- Populated by loadLanguages() -->
          <li class="text-slate-500">Loading language breakdown‚Ä¶</li>
        </ul>
      </NeonCard>

      <!-- Key Capabilities -->
      <NeonCard class="p-6 lg:col-span-1">
        <h2 class="font-display text-2xl text-white">Key Capabilities</h2>
        <ul class="mt-3 list-disc space-y-2 pl-5 text-slate-300/90">
          <li>Tabbed Admin Library for Tracks / Albums / Artists.</li>
          <li>Inline add & edit rows; bulk delete with confirmation modals.</li>
          <li>Search & sort across artist, album, and track.
          </li>
          <li>Role-based access control and guarded routes.</li>
          <li>MySQL models, migrations, and REST endpoints.</li>
        </ul>
      </NeonCard>
    </div>
  </section>

  <!-- Dashboard Preview -->
  <section class="mx-auto max-w-6xl px-4 pb-16 sm:pb-24">
    <h2 class="font-display text-2xl text-white">Dashboard Preview</h2>
    <p class="mt-1 text-slate-300/90">Screenshots of the admin views and playlist builder.</p>

    <div class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
 (dashboard-style thumbnails) -->
  <section class="mx-auto max-w-6xl px-4 pb-16 sm:pb-24">
    <h2 class="font-display text-xl text-white">Mini Previews</h2>
    <p class="mt-1 text-slate-300/90">Hover to illuminate; click to open full image.</p>

    <div class="mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
      <!-- Replace the src paths with real screenshots from /public/images/mlms/... -->
      <NeonFrame class="group relative block overflow-hidden rounded-2xl">
        <a href="/images/mlms/admin-library.png" target="_blank" rel="noopener">
          <img src="/images/mlms/admin-library.png" alt="Admin Library View"
               class="aspect-video w-full object-cover opacity-80 transition group-hover:opacity-100" loading="lazy" />
        </a>
      </NeonFrame>
      <NeonFrame class="group relative block overflow-hidden rounded-2xl">
        <a href="/images/mlms/playlist-creator.png" target="_blank" rel="noopener">
          <img src="/images/mlms/playlist-creator.png" alt="Playlist Creator"
               class="aspect-video w-full object-cover opacity-80 transition group-hover:opacity-100" loading="lazy" />
        </a>
      </NeonFrame>
      <NeonFrame class="group relative block overflow-hidden rounded-2xl">
        <a href="/images/mlms/admin-dashboard.png" target="_blank" rel="noopener">
          <img src="/images/mlms/admin-dashboard.png" alt="Admin Dashboard"
               class="aspect-video w-full object-cover opacity-80 transition group-hover:opacity-100" loading="lazy" />
        </a>
      </NeonFrame>
    </div>
  </section>

  <!-- Scripts: GitHub API fetch for live stats and language breakdown -->
  <script>
    const owner = "zeshanbasaran";
    const repo  = "mlms-project";

    async function loadRepoStats() {
      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
        if (!res.ok) return;
        const data = await res.json();
        const toLocalTime = (iso) => new Date(iso).toLocaleString();
        const byId = (id) => document.getElementById(id);
        byId('stars').textContent  = (data.stargazers_count ?? 0).toString();
        byId('forks').textContent  = (data.forks_count ?? 0).toString();
        byId('issues').textContent = (data.open_issues_count ?? 0).toString();
        byId('pushed').textContent = data.pushed_at ? toLocalTime(data.pushed_at) : '‚Äî';
      } catch {}
    }

    async function loadLanguages() {
      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/languages`);
        if (!res.ok) return;
        const data = await res.json();
        const total = Object.values(data).reduce((a, b) => a + b, 0);
        const items = Object.entries(data)
          .map(([name, bytes]) => {
            const pct = total ? Math.round((bytes / total) * 1000) / 10 : 0;
            return { name, pct };
          })
          // Filter strictly greater than 0% (avoids 0.0)
          .filter((x) => x.pct > 0)
          // Sort descending by percentage
          .sort((a, b) => b.pct - a.pct)
          .map(({ name, pct }) => `<li><span class="font-medium text-slate-200">${name}</span> ¬∑ ${pct}%</li>`)
          .join("\n");
        const ul = document.getElementById('langList');
        if (ul) ul.innerHTML = items || '<li class="text-slate-500">No language data</li>';
      } catch {}
    }

    loadRepoStats();
    loadLanguages();
  </script>
</Base>
